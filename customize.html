<!DOCTYPE html>
<html lang="en">
<head>
  <!-- Google Tag Manager -->
  <script>(function(w,d,s,l,i){w[l]=w[l]||[];w[l].push({'gtm.start':
  new Date().getTime(),event:'gtm.js'});var f=d.getElementsByTagName(s)[0],
  j=d.createElement(s),dl=l!='dataLayer'?'&l='+l:'';j.async=true;j.src=
  'https://www.googletagmanager.com/gtm.js?id='+i+dl;f.parentNode.insertBefore(j,f);
  })(window,document,'script','dataLayer','GTM-TJDWMQZV');</script>
  <!-- End Google Tag Manager -->

  <meta charset="UTF-8" />
  <title>Your Custom Trek Itinerary - Smart Trails</title>
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <link href="https://cdn.jsdelivr.net/npm/tailwindcss@2.2.19/dist/tailwind.min.css" rel="stylesheet">
  <link rel="stylesheet" href="styles/main.css" />
  
  <style>
    /* CSS Variables for consistent theming */
    :root {
      --primary: #2D5016;
      --primary-light: #4A7C28;
      --primary-lighter: #6B9A3C;
      --accent: #F39C12;
      --orange: #F39C12;
      --text-dark: #2C3E50;
      --text-light: #5D6D7E;
      --bg-light: #F8F9FA;
      --white: #FFFFFF;
      --shadow: rgba(0, 0, 0, 0.1);
      --success: #27AE60;
      --warning: #E74C3C;
      --info: #3498DB;
      --text-primary: #222222;
      --text-secondary: #717171;
      --border: #DDDDDD;
      --background-secondary: #F7F7F7;
      --radius: 12px;
      --radius-sm: 8px;
      --shadow-sm: rgba(0, 0, 0, 0.04) 0px 6px 16px;
      --shadow-md: rgba(0, 0, 0, 0.12) 0px 6px 16px;
      --shadow-lg: rgba(0, 0, 0, 0.12) 0px 6px 20px;
    }

    body {
      font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, 'Helvetica Neue', Arial, sans-serif;
      background-color: var(--bg-light);
    }

    /* Main content area */
    .main-content-area {
      max-width: 1200px;
      margin: 0 auto;
      padding: 40px 20px;
    }

    /* Loading State */
    .loading-overlay {
      position: fixed;
      top: 0;
      left: 0;
      right: 0;
      bottom: 0;
      background: rgba(255, 255, 255, 0.98);
      display: none;
      align-items: center;
      justify-content: center;
      flex-direction: column;
      z-index: 1000;
      backdrop-filter: blur(10px);
    }

    .loading-overlay.active {
      display: flex;
    }

    .loading-content {
      text-align: center;
      max-width: 500px;
      padding: 20px;
    }

    .loading-spinner {
      width: 60px;
      height: 60px;
      border: 3px solid #E8F5E9;
      border-top-color: var(--primary);
      border-right-color: var(--primary-light);
      border-radius: 50%;
      animation: spin 0.8s linear infinite;
      margin: 0 auto 32px;
    }

    @keyframes spin {
      to { transform: rotate(360deg); }
    }

    .loading-stages {
      display: flex;
      justify-content: center;
      gap: 24px;
      margin-bottom: 32px;
      flex-wrap: wrap;
    }

    .stage {
      display: flex;
      flex-direction: column;
      align-items: center;
      gap: 8px;
      opacity: 0.3;
      transition: all 0.5s ease;
    }

    .stage.active {
      opacity: 1;
      transform: scale(1.1);
    }

    .stage.completed {
      opacity: 0.7;
    }

    .stage-icon {
      font-size: 28px;
      filter: grayscale(1);
      transition: all 0.5s ease;
    }

    .stage.active .stage-icon {
      filter: grayscale(0);
      animation: bounce 1s ease-in-out infinite;
    }

    .stage.completed .stage-icon {
      filter: grayscale(0);
    }

    @keyframes bounce {
      0%, 100% { transform: translateY(0); }
      50% { transform: translateY(-10px); }
    }

    .stage-label {
      font-size: 12px;
      color: var(--text-secondary);
      font-weight: 500;
      white-space: nowrap;
    }

    .stage.active .stage-label {
      color: var(--primary);
    }

    .loading-text {
      font-size: 18px;
      color: var(--text-primary);
      font-weight: 600;
      margin-bottom: 24px;
    }

    .hiking-fact-container {
      background: #F0F7ED;
      border: 1px solid #E8F5E9;
      border-radius: var(--radius);
      padding: 16px 20px;
      display: flex;
      align-items: center;
      gap: 12px;
      margin-top: 24px;
      min-height: 60px;
    }

    .fact-icon {
      font-size: 24px;
      flex-shrink: 0;
    }

    .hiking-fact {
      font-size: 14px;
      color: var(--text-secondary);
      line-height: 1.5;
      text-align: left;
      animation: fadeIn 0.5s ease;
    }

    /* Enhanced loading card for customize.js compatibility */
    .loading-card {
      background: white;
      border-radius: 16px;
      padding: 40px;
      box-shadow: 0 4px 20px var(--shadow);
      text-align: center;
    }

    .loading-card h3 {
      font-size: 1.3em;
      color: var(--text-dark);
      margin-bottom: 15px;
    }

    @keyframes fadeIn {
      from { opacity: 0; transform: translateY(5px); }
      to { opacity: 1; transform: translateY(0); }
    }

    /* Results Container */
    #itinerary-cards {
      opacity: 0;
      transform: translateY(20px);
      transition: all 0.5s cubic-bezier(0.4, 0, 0.2, 1) 0.3s;
      position: relative;
      z-index: 10;
    }

    #itinerary-cards.show {
      opacity: 1;
      transform: translateY(0);
    }

    /* Navigation Tabs for Results */
    .results-nav-tabs {
      background: white;
      box-shadow: 0 2px 10px var(--shadow);
      margin-bottom: 40px;
      border-radius: 16px;
      overflow: hidden;
    }

    .results-nav-container {
      display: flex;
      overflow-x: auto;
      -webkit-overflow-scrolling: touch;
      scrollbar-width: none;
    }

    .results-nav-container::-webkit-scrollbar {
      display: none;
    }

    .results-nav-tab {
      padding: 20px 30px;
      border: none;
      background: none;
      cursor: pointer;
      font-size: 1em;
      font-weight: 600;
      color: var(--text-secondary);
      white-space: nowrap;
      transition: all 0.3s ease;
      position: relative;
    }

    .results-nav-tab:hover {
      color: var(--primary);
      background: var(--bg-light);
    }

    .results-nav-tab.active {
      color: var(--primary);
      background: var(--bg-light);
    }

    .results-nav-tab.active::after {
      content: '';
      position: absolute;
      bottom: 0;
      left: 0;
      right: 0;
      height: 3px;
      background: var(--primary);
    }

    /* Enhanced Itinerary Timeline */
    .itinerary-timeline {
      position: relative;
      padding-left: 40px;
    }

    .itinerary-timeline::before {
      content: '';
      position: absolute;
      left: 10px;
      top: 0;
      bottom: 0;
      width: 2px;
      background: #E0E0E0;
    }

    /* Day Cards */
    .itinerary-day-card {
      position: relative;
      margin-bottom: 40px;
      background: white;
      border-radius: 16px;
      padding: 0;
      box-shadow: 0 4px 20px var(--shadow);
      transition: all 0.3s ease;
      overflow: hidden;
    }

    .itinerary-day-card:hover {
      transform: translateY(-2px);
      box-shadow: 0 6px 30px var(--shadow);
    }

    .day-card-header {
      background: linear-gradient(135deg, #f8fafb 0%, #e8f0e5 100%);
      padding: 25px 30px;
      border-bottom: 1px solid #e5e7eb;
      position: relative;
    }

    .day-number {
      font-size: 0.85em;
      color: var(--primary);
      font-weight: 700;
      text-transform: uppercase;
      letter-spacing: 1.5px;
      margin-bottom: 8px;
    }

    .day-title-enhanced {
      font-size: 1.4em;
      margin: 0;
      color: var(--text-dark);
      font-weight: 700;
      line-height: 1.3;
    }

    /* Main Content Section */
    .day-card-content {
      padding: 35px;
    }

    /* Description Box */
    .day-description-box {
      background: #f0f7ff;
      border-left: 4px solid var(--info);
      padding: 20px;
      border-radius: 8px;
      margin-bottom: 30px;
    }

    .day-description-enhanced {
      color: var(--text-dark);
      line-height: 1.8;
      margin: 0;
      font-size: 0.95em;
    }

    /* Distance section */
    .distance-section {
      display: flex;
      align-items: center;
      gap: 10px;
      margin-bottom: 25px;
      padding: 16px 20px;
      background: #f0f4f8;
      border-radius: 12px;
      border-left: 4px solid var(--primary);
    }

    .distance-icon {
      font-size: 1.2em;
      flex-shrink: 0;
    }

    .distance-text {
      font-size: 1.05em;
      font-weight: 500;
      color: var(--text-dark);
    }

    /* Grouped details container */
    .grouped-details-container {
      display: flex;
      flex-direction: column;
      gap: 30px;
    }

    /* Detail groups */
    .detail-group {
      border: 1px solid #e5e7eb;
      border-radius: 12px;
      padding: 24px;
      background: #fafbfc;
    }

    .detail-group-title {
      font-size: 1.1em;
      font-weight: 700;
      color: var(--text-dark);
      margin-bottom: 20px;
      padding-bottom: 12px;
      border-bottom: 2px solid #e5e7eb;
      text-transform: uppercase;
      letter-spacing: 0.5px;
    }

    .detail-group-content {
      display: flex;
      flex-direction: column;
      gap: 16px;
    }

    /* Individual detail items */
    .detail-item {
      padding: 12px 16px;
      border-bottom: 1px solid #f0f0f0;
      margin: 0;
      background: white;
      border-radius: 8px;
      margin-bottom: 8px;
    }

    .detail-item:last-child {
      border-bottom: none;
      padding-bottom: 12px;
      margin-bottom: 0;
    }

    .detail-item .detail-header {
      display: flex;
      align-items: flex-start;
      gap: 10px;
      margin-bottom: 8px;
    }

    .detail-item .detail-icon {
      font-size: 1.1em;
      width: 24px;
      min-width: 24px;
      text-align: center;
      flex-shrink: 0;
      display: inline-flex;
      align-items: center;
      justify-content: center;
      height: 24px;
      line-height: 1;
    }

    .detail-item .detail-label {
      font-weight: 600;
      color: var(--text-dark);
      font-size: 0.95em;
    }

    .detail-item .detail-content {
      color: var(--text-secondary);
      line-height: 1.6;
      font-size: 0.95em;
      padding-left: 34px;
      margin: 0;
    }

    /* Regular detail items */
    .detail-item:not(.highlights):not(.tips) {
      background: transparent;
      border-radius: 0;
      margin-bottom: 0;
      border: none;
      padding: 12px 0;
    }

    /* Special styling for highlights */
    .detail-item.highlights {
      background: white;
      border: 1px solid #fcd34d;
      border-radius: 8px;
      padding: 16px;
      margin-bottom: 12px;
    }

    .detail-item.highlights .detail-header {
      margin-bottom: 10px;
    }

    .detail-item.highlights .detail-content {
      background: #fef9e7;
      padding: 12px 16px;
      border-radius: 6px;
      margin-left: 0;
      padding-left: 16px;
      border-left: 3px solid #f39c12;
      font-style: italic;
      color: #92400e;
    }

    /* Special styling for tips */
    .detail-item.tips {
      background: white;
      border: 1px solid #86efac;
      border-radius: 8px;
      padding: 16px;
      margin-bottom: 12px;
    }

    .detail-item.tips .detail-header {
      margin-bottom: 10px;
    }

    .detail-item.tips .detail-content {
      background: #f0fdf4;
      padding: 12px 16px;
      border-radius: 6px;
      margin-left: 0;
      padding-left: 16px;
      border-left: 3px solid #4ade80;
      font-style: italic;
      color: #166534;
    }

    /* Special styling for difficulty color */
    .detail-item.difficulty .detail-content {
      font-weight: 600;
    }

    /* Collapsible Day Cards */
    .day-card-toggle {
      position: absolute;
      top: 25px;
      right: 30px;
      background: white;
      border: 2px solid #e5e7eb;
      border-radius: 50%;
      width: 36px;
      height: 36px;
      display: flex;
      align-items: center;
      justify-content: center;
      cursor: pointer;
      transition: all 0.2s ease;
    }

    .day-card-toggle:hover {
      border-color: var(--primary);
      transform: scale(1.05);
    }

    .day-card-toggle svg {
      width: 20px;
      height: 20px;
      transition: transform 0.3s ease;
      color: var(--text-secondary);
    }

    .itinerary-day-card.collapsed .day-card-toggle svg {
      transform: rotate(180deg);
    }

    .itinerary-day-card.collapsed .day-card-content {
      display: none;
    }

    /* Enhanced timeline dot */
    .itinerary-day-card::before {
      content: '';
      position: absolute;
      left: -30px;
      top: 35px;
      width: 20px;
      height: 20px;
      background: white;
      border: 3px solid var(--primary);
      border-radius: 50%;
      box-shadow: 0 0 0 4px rgba(45, 80, 22, 0.1);
      z-index: 1;
    }

    /* Additional Sections Cards */
    .info-card {
      background: white;
      border-radius: 16px;
      padding: 30px;
      box-shadow: 0 4px 20px var(--shadow);
      margin-bottom: 30px;
    }

    .info-card h3 {
      font-size: 1.8em;
      margin-bottom: 25px;
      color: var(--text-dark);
      display: flex;
      align-items: center;
      gap: 15px;
    }

    .info-card-icon {
      font-size: 1.5em;
    }

    /* Section Headers */
    .section-header {
      font-size: 2.5em;
      font-weight: 700;
      color: var(--text-dark);
      margin-bottom: 15px;
      margin-top: 50px;
    }

    .section-subtitle {
      font-size: 1.1em;
      color: var(--text-secondary);
      margin-bottom: 40px;
    }

    /* Content Sections */
    .content-section-result {
      display: none;
    }

    .content-section-result.active {
      display: block;
      animation: fadeIn 0.5s ease-out;
    }

    .enhanced-content {
      color: var(--text-secondary);
      line-height: 1.8;
    }

    /* Action Buttons */
    .action-buttons-container {
      display: flex;
      gap: 20px;
      margin-top: 40px;
      flex-wrap: wrap;
    }

    .action-btn {
      flex: 1;
      min-width: 200px;
      padding: 15px 30px;
      border-radius: 30px;
      font-size: 1em;
      font-weight: 600;
      text-decoration: none;
      transition: all 0.3s ease;
      cursor: pointer;
      border: none;
      display: inline-flex;
      align-items: center;
      justify-content: center;
      gap: 10px;
    }

    .action-btn-primary {
      background: linear-gradient(135deg, var(--primary) 0%, var(--primary-light) 100%);
      color: white;
      box-shadow: 0 4px 15px rgba(45, 80, 22, 0.3);
    }

    .action-btn-primary:hover {
      transform: translateY(-2px);
      box-shadow: 0 6px 20px rgba(45, 80, 22, 0.4);
    }

    .action-btn-secondary {
      background: white;
      color: var(--primary);
      border: 2px solid var(--primary);
    }

    .action-btn-secondary:hover {
      background: var(--primary);
      color: white;
    }

    /* Modal styles */
    .modal-overlay {
      position: fixed;
      top: 0;
      left: 0;
      right: 0;
      bottom: 0;
      background: rgba(0, 0, 0, 0.6);
      display: flex;
      align-items: center;
      justify-content: center;
      z-index: 1000;
      backdrop-filter: blur(4px);
    }

    .modal {
      background: rgba(255, 255, 255, 0.95);
      backdrop-filter: blur(10px);
      border-radius: 24px;
      padding: 40px;
      max-width: 480px;
      width: 90%;
      position: relative;
      box-shadow: 0 20px 40px rgba(0, 0, 0, 0.15);
      border: 1px solid rgba(255, 255, 255, 0.2);
      transform: scale(1);
      animation: modalAppear 0.3s ease-out;
    }

    .auth-icon {
      width: 80px;
      height: 80px;
      background: linear-gradient(135deg, #4A7C28, #2D5016);
      border-radius: 20px;
      display: flex;
      align-items: center;
      justify-content: center;
      margin: 0 auto 24px;
      animation: iconBounce 0.6s ease-out 0.2s both;
      box-shadow: 0 8px 16px rgba(45, 80, 22, 0.3);
    }
    
    .welcome-icon {
      background: linear-gradient(135deg, #4A7C28, #2D5016);
      box-shadow: 0 8px 16px rgba(45, 80, 22, 0.3);
    }
    
    .auth-icon svg {
      width: 40px;
      height: 40px;
      stroke: white;
      stroke-width: 2;
      fill: white;
    }
    
    .modal-title {
      font-size: 28px;
      font-weight: 700;
      color: #1f2937;
      text-align: center;
      margin-bottom: 12px;
      background: linear-gradient(135deg, #1f2937, #4b5563);
      -webkit-background-clip: text;
      -webkit-text-fill-color: transparent;
    }
    
    .modal-message {
      font-size: 16px;
      color: #6b7280;
      text-align: center;
      margin-bottom: 24px;
      line-height: 1.5;
    }
    
    .auth-benefits {
      margin: 24px 0;
      text-align: left;
      background: #f0f7e7;
      padding: 20px;
      border-radius: 12px;
      border-left: 4px solid #4A7C28;
    }
    
    .auth-benefits h4 {
      font-size: 14px;
      font-weight: 600;
      color: #2D5016;
      margin-bottom: 12px;
    }
    
    .benefit-item {
      display: flex;
      align-items: center;
      margin-bottom: 12px;
      font-size: 14px;
      color: #2D5016;
    }
    
    .benefit-item:before {
      content: "✓";
      color: #4A7C28;
      font-weight: bold;
      margin-right: 10px;
      font-size: 16px;
    }
    
    .button-primary {
      background: linear-gradient(135deg, #4A7C28, #2D5016);
      color: white;
      padding: 16px 24px;
      border-radius: 12px;
      font-size: 16px;
      font-weight: 600;
      cursor: pointer;
      transition: all 0.2s ease;
      border: none;
      text-decoration: none;
      text-align: center;
      display: inline-block;
      box-shadow: 0 4px 12px rgba(45, 80, 22, 0.3);
      margin-bottom: 12px;
      width: 100%;
    }
    
    .button-primary:hover {
      transform: translateY(-1px);
      box-shadow: 0 6px 16px rgba(45, 80, 22, 0.4);
    }
    
    .button-secondary {
      background: transparent;
      color: #2D5016;
      border: 2px solid #4A7C28;
      padding: 16px 24px;
      border-radius: 12px;
      font-size: 16px;
      font-weight: 600;
      cursor: pointer;
      transition: all 0.2s ease;
      text-decoration: none;
      text-align: center;
      display: inline-block;
      width: 100%;
    }
    
    .button-secondary:hover {
      background: #4A7C28;
      color: white;
      transform: translateY(-1px);
    }
    
    .button-group {
      display: flex;
      flex-direction: column;
      gap: 12px;
      margin-top: 32px;
    }
    
    .close-button {
      position: absolute;
      top: 16px;
      right: 16px;
      width: 32px;
      height: 32px;
      border: none;
      background: #f3f4f6;
      border-radius: 50%;
      cursor: pointer;
      display: flex;
      align-items: center;
      justify-content: center;
      transition: all 0.2s ease;
      color: #6b7280;
    }
    
    .close-button:hover {
      background: #e5e7eb;
      transform: scale(1.1);
    }
    
    @keyframes iconBounce {
      0% {
        opacity: 0;
        transform: scale(0.3);
      }
      50% {
        transform: scale(1.1);
      }
      100% {
        opacity: 1;
        transform: scale(1);
      }
    }
    
    @keyframes modalAppear {
      from {
        opacity: 0;
        transform: scale(0.9) translateY(-20px);
      }
      to {
        opacity: 1;
        transform: scale(1) translateY(0);
      }
    }
    
    @keyframes fadeOut {
      from { opacity: 1; }
      to { opacity: 0; }
    }

    /* Responsive */
    @media (max-width: 768px) {
      .main-content-area {
        padding: 20px 16px;
      }

      .section-header {
        font-size: 2em;
      }

      .results-nav-tab {
        padding: 16px 20px;
        font-size: 0.9em;
      }

      .day-card-header {
        padding: 20px;
      }

      .day-card-content {
        padding: 20px;
      }

      .detail-group {
        padding: 18px;
      }

      .detail-group-title {
        font-size: 1em;
        margin-bottom: 15px;
      }

      .grouped-details-container {
        gap: 20px;
      }

      .detail-item {
        padding: 12px;
      }

      .detail-item .detail-content {
        padding-left: 0;
        margin-top: 5px;
      }

      .detail-item.highlights .detail-content,
      .detail-item.tips .detail-content {
        margin-left: 0;
        margin-top: 10px;
        padding: 12px 16px;
      }

      .action-buttons-container {
        flex-direction: column;
      }

      .action-btn {
        width: 100%;
      }

      .info-card {
        padding: 20px;
      }

      .info-card h3 {
        font-size: 1.5em;
      }

      .loading-stages {
        gap: 16px;
      }

      .stage-icon {
        font-size: 24px;
      }

      .stage-label {
        font-size: 11px;
      }

      .hiking-fact {
        font-size: 13px;
      }
    }

    @media (max-width: 480px) {
      .loading-stages {
        gap: 12px;
      }

      .stage {
        flex: 0 0 45%;
      }
    }
  </style>
</head>
<body>
  <!-- Google Tag Manager (noscript) -->
  <noscript><iframe src="https://www.googletagmanager.com/ns.html?id=GTM-TJDWMQZV"
  height="0" width="0" style="display:none;visibility:hidden"></iframe></noscript>
  <!-- End Google Tag Manager (noscript) -->

  <!-- Main Content Area -->
  <main class="main-content-area">
    <!-- Results Container -->
    <div id="itinerary-cards"></div>
  </main>

  <!-- Loading Overlay -->
  <div class="loading-overlay active" id="loadingOverlay">
    <div class="loading-content">
      <div class="loading-spinner"></div>
      
      <div class="loading-stages">
        <div class="stage active" data-stage="1">
          <div class="stage-icon">🗺️</div>
          <div class="stage-label">Analyzing preferences</div>
        </div>
        <div class="stage" data-stage="2">
          <div class="stage-icon">🏔️</div>
          <div class="stage-label">Finding perfect trails</div>
        </div>
        <div class="stage" data-stage="3">
          <div class="stage-icon">🏕️</div>
          <div class="stage-label">Planning accommodations</div>
        </div>
        <div class="stage" data-stage="4">
          <div class="stage-icon">✨</div>
          <div class="stage-label">Crafting your itinerary</div>
        </div>
      </div>
      
      <div class="loading-text">Creating your perfect trek...</div>
      
      <div class="hiking-fact-container">
        <div class="fact-icon">💡</div>
        <div class="hiking-fact" id="hikingFact">Did you know? The Appalachian Trail spans 2,190 miles across 14 states!</div>
      </div>
    </div>
  </div>

  <!-- Success Modal -->
  <div class="modal-overlay" id="itinerary-success-modal" style="display: none;">
    <div class="modal">
      <button class="close-button" onclick="closeSuccessModal()" aria-label="Close">
        <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor">
          <line x1="18" y1="6" x2="6" y2="18"></line>
          <line x1="6" y1="6" x2="18" y2="18"></line>
        </svg>
      </button>
      
      <div class="auth-icon">
        <svg viewBox="0 0 24 24">
          <polyline points="20,6 9,17 4,12"></polyline>
        </svg>
      </div>
      
      <h2 class="modal-title">Adventure Saved! 🎉</h2>
      <p class="modal-message">Your custom itinerary has been safely stored in your account. Ready to hit the trails!</p>
      
      <div class="button-group">
        <a href="my-itineraries.html" class="button button-primary">
          View My Adventures
        </a>
        <button class="button button-secondary" onclick="closeSuccessModal()">
          Plan Another Trek
        </button>
      </div>
    </div>
  </div>

  <!-- Authentication Required Modal -->
  <div class="modal-overlay" id="auth-required-modal" style="display: none;">
    <div class="modal">
      <button class="close-button" onclick="closeAuthModal()" aria-label="Close">
        <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor">
          <line x1="18" y1="6" x2="6" y2="18"></line>
          <line x1="6" y1="6" x2="18" y2="18"></line>
        </svg>
      </button>
      
      <div class="auth-icon">
        <svg width="40" height="40" viewBox="0 0 24 24" fill="white">
          <path d="M14 6l-3.75 5 2.85 3.8-1.6 1.2C9.81 13.75 7 10 7 10l-6 8h22l-9-12z"/>
        </svg>
      </div>
      
      <h2 class="modal-title">🏔️ Save Your Adventure</h2>
      <p class="modal-message">Join thousands of adventurers and save your custom itinerary to access it anytime, anywhere!</p>
      
      <div class="auth-benefits">
        <h4>🎯 What you'll get:</h4>
        <div class="benefit-item">Personalized trail recommendations</div>
        <div class="benefit-item">Gear lists and local insights</div>
        <div class="benefit-item">Save your favorite itineraries</div>
        <div class="benefit-item">Regenerate itineraries with feedback</div>
      </div>
      
      <div class="button-group">
        <button class="button-primary" onclick="redirectToSignUp()">
          🚀 Join Our Community
        </button>
        <button class="button-secondary" onclick="redirectToSignIn()">
          🏠 I Have an Account
        </button>
      </div>
    </div>
  </div>

  <!-- Welcome Back Modal -->
  <div class="modal-overlay" id="welcome-back-modal" style="display: none;">
    <div class="modal">
      <button class="close-button" onclick="closeWelcomeModal()" aria-label="Close">
        <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor">
          <line x1="18" y1="6" x2="6" y2="18"></line>
          <line x1="6" y1="6" x2="18" y2="18"></line>
        </svg>
      </button>
      
      <div class="auth-icon welcome-icon">
        <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
          <path d="M22 11.08V12a10 10 0 1 1-5.93-9.14"/>
          <polyline points="22,4 12,14.01 9,11.01"/>
        </svg>
      </div>
      
      <h2 class="modal-title">🎉 Welcome to Smart Trails!</h2>
      <p class="modal-message">Your adventure has been saved! You're now part of our amazing trekking community.</p>
      
      <div class="button-group">
        <a href="my-itineraries.html" class="button-primary">
          🗺️ View My Adventures
        </a>
        <button class="button-secondary" onclick="closeWelcomeModal()">
          🥾 Plan Another Trek
        </button>
      </div>
    </div>
  </div>

  <!-- Footer Container -->
  <div id="footer-container"></div>

  <!-- Scripts -->
  <script src="js/utils/itinerary.js" type="module"></script>
  <script src="js/pages/customize.js" type="module"></script>
  <script src="js/components/navbar.js" type="module"></script>
  <script src="js/components/footer.js" type="module"></script>
  
  <!-- Initialize Script -->
  <script>
    // Loading animation functions
    let stageInterval;
    let factInterval;
    let currentStage = 1;

    const hikingFacts = [
      "Did you know? The Appalachian Trail spans 2,190 miles across 14 states!",
      "Fun fact: Mount Everest grows about 4 millimeters each year due to geological forces.",
      "Hiking tip: The 'Leave No Trace' principles help preserve trails for future generations.",
      "Did you know? The Inca Trail to Machu Picchu limits visitors to 500 per day to protect the path.",
      "Trail wisdom: 'Cotton kills' - synthetic fabrics dry faster and keep you warmer when wet.",
      "Fun fact: The Pacific Crest Trail crosses through 7 national parks and 25 national forests.",
      "Did you know? Norway's 'allemannsretten' law gives everyone the right to roam freely in nature.",
      "Hiking burns about 400-700 calories per hour depending on terrain and pack weight.",
      "The longest hiking trail in the world is Canada's Trans Canada Trail at 24,000 km!",
      "Did you know? Studies show that hiking can increase creative problem-solving by 50%.",
      "Fun fact: The Swiss have over 65,000 km of marked hiking trails - that's 1.5x Earth's circumference!",
      "Trail tip: Trekking poles can reduce stress on knees by up to 25% on descents."
    ];

    function startLoadingAnimation() {
      currentStage = 1;
      
      // Update stages every 3 seconds
      stageInterval = setInterval(() => {
        const currentStageEl = document.querySelector(`.stage[data-stage="${currentStage}"]`);
        if (currentStageEl) {
          currentStageEl.classList.remove('active');
          currentStageEl.classList.add('completed');
        }
        
        currentStage++;
        if (currentStage <= 4) {
          const nextStageEl = document.querySelector(`.stage[data-stage="${currentStage}"]`);
          if (nextStageEl) {
            nextStageEl.classList.add('active');
          }
        }
      }, 3000);
      
      // Rotate facts every 4 seconds
      let factIndex = 0;
      factInterval = setInterval(() => {
        factIndex = (factIndex + 1) % hikingFacts.length;
        const factElement = document.getElementById('hikingFact');
        if (factElement) {
          factElement.style.animation = 'none';
          setTimeout(() => {
            factElement.textContent = hikingFacts[factIndex];
            factElement.style.animation = 'fadeIn 0.5s ease';
          }, 10);
        }
      }, 4000);
    }

    function stopLoadingAnimation() {
      clearInterval(stageInterval);
      clearInterval(factInterval);
      
      // Reset stages
      document.querySelectorAll('.stage').forEach(stage => {
        stage.classList.remove('active', 'completed');
      });
      const firstStage = document.querySelector('.stage[data-stage="1"]');
      if (firstStage) {
        firstStage.classList.add('active');
      }
    }

    // Modal functions
    function closeSuccessModal() {
      const modal = document.getElementById('itinerary-success-modal');
      modal.style.animation = 'fadeOut 0.2s ease-out forwards';
      setTimeout(() => {
        modal.style.display = 'none';
        modal.style.animation = '';
      }, 200);
    }

    function closeAuthModal() {
      const modal = document.getElementById('auth-required-modal');
      modal.style.animation = 'fadeOut 0.2s ease-out forwards';
      setTimeout(() => {
        modal.style.display = 'none';
        modal.style.animation = '';
      }, 200);
    }

    function closeWelcomeModal() {
      const modal = document.getElementById('welcome-back-modal');
      modal.style.animation = 'fadeOut 0.2s ease-out forwards';
      setTimeout(() => {
        modal.style.display = 'none';
        modal.style.animation = '';
      }, 200);
    }

    function redirectToSignUp() {
      window.location.href = 'sign-up.html';
    }

    function redirectToSignIn() {
      window.location.href = 'sign-up.html';
    }

    // Toggle day card function
    function toggleDayCard(button) {
      const dayCard = button.closest('.itinerary-day-card');
      dayCard.classList.toggle('collapsed');
    }

    // Close modals when clicking outside
    document.addEventListener('click', function(e) {
      const successModal = document.getElementById('itinerary-success-modal');
      const authModal = document.getElementById('auth-required-modal');
      const welcomeModal = document.getElementById('welcome-back-modal');
      
      if (e.target === successModal) closeSuccessModal();
      if (e.target === authModal) closeAuthModal();
      if (e.target === welcomeModal) closeWelcomeModal();
    });

    // Close modals with Escape key
    document.addEventListener('keydown', function(e) {
      if (e.key === 'Escape') {
        const successModal = document.getElementById('itinerary-success-modal');
        const authModal = document.getElementById('auth-required-modal');
        const welcomeModal = document.getElementById('welcome-back-modal');
        
        if (successModal.style.display === 'flex') closeSuccessModal();
        if (authModal.style.display === 'flex') closeAuthModal();
        if (welcomeModal.style.display === 'flex') closeWelcomeModal();
      }
    });

    // Initialize on page load
    document.addEventListener('DOMContentLoaded', async () => {
      // Start loading animation
      startLoadingAnimation();
      
      // Get quiz data from localStorage
      const quizDataStr = localStorage.getItem('quizData');
      
      if (!quizDataStr) {
        // No quiz data - redirect back to home
        console.error('No quiz data found');
        window.location.href = 'index.html';
        return;
      }
      
      try {
        const quizData = JSON.parse(quizDataStr);
        console.log('Quiz data received:', quizData);
        
        // Clear the stored data
        localStorage.removeItem('quizData');
        
        // Wait for customize.js to load and then generate itinerary
        const waitForFunction = async () => {
          let attempts = 0;
          while (!window.generateItineraryFromQuiz && attempts < 50) {
            await new Promise(resolve => setTimeout(resolve, 100));
            attempts++;
          }
          
          if (window.generateItineraryFromQuiz) {
            console.log('Calling generateItineraryFromQuiz with data:', quizData);
            
            // Stop the initial loading animation as customize.js will handle its own
            setTimeout(() => {
              stopLoadingAnimation();
              document.getElementById('loadingOverlay').classList.remove('active');
            }, 1000);
            
            // Generate the itinerary
            await window.generateItineraryFromQuiz(quizData);
          } else {
            console.error('generateItineraryFromQuiz function not found');
            document.getElementById('itinerary-cards').innerHTML = `
              <div class="info-card">
                <h3 style="color: var(--warning);">Error Loading Itinerary</h3>
                <p>There was an error generating your itinerary. Please try again.</p>
                <button onclick="window.location.href='index.html'" style="
                  margin-top: 20px;
                  background: var(--primary);
                  color: white;
                  padding: 12px 24px;
                  border: none;
                  border-radius: 8px;
                  font-size: 14px;
                  font-weight: 600;
                  cursor: pointer;
                ">Start Over</button>
              </div>
            `;
            stopLoadingAnimation();
            document.getElementById('loadingOverlay').classList.remove('active');
          }
        };
        
        await waitForFunction();
        
      } catch (error) {
        console.error('Error parsing quiz data:', error);
        window.location.href = 'index.html';
      }
    });
  </script>
</body>
</html>